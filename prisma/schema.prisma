generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/* ---------- ENUMS ---------- */
enum FuelType {
  GASOLEO
  GASOLEO_HI_ENERGY
  GASOLINA_95
  GASOLEO_AGRICOLA
}

enum Category {
  LUBRIFICANTES
  ADITIVOS
  LAVAGEM
  ACESSORIOS
  OUTROS
}

/* ---------- MODELOS ---------- */

model Station {
  id                 Int      @id @default(autoincrement())
  nome_comercial     String
  morada             String
  codigo_postal      String
  localidade         String
  lat                Float?
  lng                Float?
  telefone           String?
  email              String?
  horario_semana     String?
  horario_fim_semana String?
  feriados_especiais String?
  servicosJson       String?
  linksJson          String?
  logoUrl            String?
  heroUrl            String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model Fuel {
  id              Int       @id @default(autoincrement())
  tipo            FuelType

  preco_atual     Decimal   @db.Decimal(10, 3)
  vigencia_inicio DateTime
  preco_anterior  Decimal?  @db.Decimal(10, 3)
  publicado       Boolean   @default(true)
  observacoes     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([tipo, publicado, vigencia_inicio])
}

model Product {
  id          Int       @id @default(autoincrement())
  nome        String
  categoria   Category

  precoCents  Int?      // null => "Sob consulta"
  descricao   String?   @default("")
  imagemUrl   String?
  ativo       Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([categoria, nome])
  @@index([ativo, categoria])

}

model Voucher {
  id                 String   @id @default(uuid())
  codigo             String   @unique // ex: "LAV-7K2M-429"
  deviceId           String   // Identificação anônima do dispositivo
  valorAbastecimento Decimal? @db.Decimal(10, 2) // Valor declarado pelo cliente
  numeroRecibo       String?  // Número do recibo/comprovante
  fotoReciboUrl      String?  // URL da foto do recibo (prova de abastecimento)
  usado              Boolean  @default(false)
  usadoEm            DateTime?
  expiraEm           DateTime
  criadoEm           DateTime @default(now())
  observacoes        String?  // Notas opcionais

  @@index([codigo])
  @@index([deviceId, criadoEm])
  @@index([usado, expiraEm])
  @@index([numeroRecibo])
}
